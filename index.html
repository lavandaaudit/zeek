<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IBONIRIUM ¬∑ Wheat Terrarium ¬∑ EXP-02</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
  width:100%; height:100%;
  background:#000;
  overflow:hidden;
}
canvas { position:fixed; inset:0; }

#info {
  position:fixed;
  bottom:12px; left:12px;
  font-family:monospace;
  color:#d6ff9e;
  font-size:12px;
  line-height:1.4;
  opacity:0.9;
}

#panel {
  position:fixed;
  bottom:12px; right:12px;
  max-width:360px;
  font-family:monospace;
  font-size:12px;
  color:#f0ffd2;
  line-height:1.45;
  background:linear-gradient(to left,rgba(0,0,0,0.65),transparent);
  padding:10px 14px;
}
</style>
</head>
<body>

<canvas id="stars"></canvas>
<canvas id="field"></canvas>
<canvas id="sensors"></canvas>

<div id="info">
<b>IBONIRIUM ¬∑ WHEAT LAB ¬∑ EXP-02</b><br>
Phase: <span id="phase">Vegetation</span><br>
Day: <span id="day">‚Äì</span><br>
Solar SSN: <span id="ssn">‚Äì</span><br>
Solar Factor: <span id="sf">‚Äì</span><br>
Growth Energy: <span id="ge">‚Äì</span><br>
Target: 13 December
</div>

<div id="panel">
<b>–ì–ï–û–ú–ï–¢–†–ò–ß–ù–ï –ü–û–õ–ï</b><br>
–ö–∞–º–µ—Ä–∞ –Ω–∞–±–ª–∏–∂–µ–Ω–∞ –¥–æ —Ä–æ—Å–ª–∏–Ω. –ö–æ–ª–æ—Å–∫–∏ —Ä–µ–¥—É–∫–æ–≤–∞–Ω—ñ –¥–æ –≥–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏—Ö —Ñ–æ—Ä–º.
–ê–Ω—ñ–º–∞—Ü—ñ—è —É–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞, –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞.
</div>

<script>
/* ===== CANVAS ===== */
const starCanvas = document.getElementById('stars');
const fieldCanvas = document.getElementById('field');
const sensorCanvas = document.getElementById('sensors');

const sctx = starCanvas.getContext('2d');
const fctx = fieldCanvas.getContext('2d');
const scx = sensorCanvas.getContext('2d');

function resize(){
  starCanvas.width = fieldCanvas.width = sensorCanvas.width = innerWidth;
  starCanvas.height = fieldCanvas.height = innerHeight;
  sensorCanvas.height = 140;
}
addEventListener('resize', resize);
resize();

/* ===== STAR FIELD ===== */
const stars = Array.from({length:180},()=>({
  x:Math.random(), y:Math.random(), z:Math.random()
}));

function drawStars(){
  sctx.clearRect(0,0,starCanvas.width,starCanvas.height);
  stars.forEach(st=>{
    st.y += 0.00015*(1+st.z);
    if(st.y>1) st.y=0;
    sctx.globalAlpha = 0.25 + st.z*0.5;
    sctx.fillStyle = "#fff";
    sctx.fillRect(
      st.x*starCanvas.width,
      st.y*starCanvas.height,
      1+st.z,
      1+st.z
    );
  });
  sctx.globalAlpha = 1;
}

/* ===== ENV DATA ===== */
let solarSSN = 0;
let solarFactor = 1;
let growthEnergy = 0;

/* ===== GEOMETRIC WHEAT ===== */
class Wheat {
  constructor(x){
    this.x = x;
    this.age = 0;
    this.maxAge = 1;
    this.modules = 6 + Math.floor(Math.random()*4);
    this.phase = Math.random()*Math.PI*2;
  }

  grow(){
    this.age += 0.00035 * solarFactor;
    if(this.age > this.maxAge) this.age = this.maxAge;
  }

  draw(){
    const baseY = fieldCanvas.height*0.82;
    const height = this.age * 260 * solarFactor;

    const sway =
      Math.sin(Date.now()*0.0006 + this.phase) *
      6 * this.age;

    let x = this.x;
    let y = baseY;

    // stem
    fctx.strokeStyle = 'rgba(170,220,140,0.7)';
    fctx.lineWidth = 1.2;
    fctx.beginPath();
    fctx.moveTo(x, y);
    fctx.lineTo(x+sway, y-height);
    fctx.stroke();

    // geometric ear (modules)
    if(this.age > 0.5){
      const mH = height*0.45;
      const step = mH / this.modules;

      for(let i=0;i<this.modules;i++){
        const py = y-height + i*step;
        const w = 6 + i*0.6;

        fctx.strokeStyle = `rgba(230,210,150,${0.85 - i*0.05})`;
        fctx.beginPath();
        fctx.moveTo(x+sway-w, py);
        fctx.lineTo(x+sway, py-step*0.6);
        fctx.lineTo(x+sway+w, py);
        fctx.stroke();
      }
    }
  }
}

/* ===== FIELD (CAMERA CLOSER) ===== */
const wheatField = Array.from({length:120},(_,i)=>
  new Wheat(innerWidth*0.15 + (i/120)*innerWidth*0.7)
);

/* ===== NOAA SOLAR API ===== */
async function updateSolar(){
  try{
    const r = await fetch(
      'https://services.swpc.noaa.gov/json/solar-cycle/predicted-solar-cycle.json'
    );
    const d = await r.json();
    const last = d[d.length-1];
    solarSSN = last.predicted_ssn;
    solarFactor = Math.min(3, 0.6 + solarSSN/120);
    growthEnergy = solarFactor * (0.7 + Math.random()*0.3);

    ssn.textContent = solarSSN.toFixed(1);
    sf.textContent = solarFactor.toFixed(2);
    ge.textContent = growthEnergy.toFixed(2);
  }catch(e){
    solarFactor = 1;
  }
}
updateSolar();
setInterval(updateSolar,1800000);

/* ===== SENSORS ===== */
function drawSensors(){
  scx.clearRect(0,0,sensorCanvas.width,sensorCanvas.height);
  const baseY = 110;

  scx.strokeStyle='rgba(150,255,200,0.25)';
  scx.beginPath();
  scx.moveTo(0,baseY);
  scx.lineTo(sensorCanvas.width,baseY);
  scx.stroke();

  scx.fillStyle='rgba(255,210,120,0.85)';
  scx.beginPath();
  scx.arc(80, baseY-40, 10+solarFactor*3, 0, Math.PI*2);
  scx.fill();
  scx.fillText('‚òÄ', 76, baseY+20);

  scx.strokeStyle='rgba(180,240,150,0.9)';
  scx.beginPath();
  scx.moveTo(160, baseY);
  scx.lineTo(160, baseY-growthEnergy*28);
  scx.stroke();
  scx.fillText('üåæ', 155, baseY+20);
}

/* ===== TIME ===== */
const START_DATE = new Date('2026-01-01');
const STOP_DATE  = new Date('2026-12-13');

function updateDay(){
  const now = new Date();
  const day = Math.floor((now-START_DATE)/(1000*60*60*24));
  dayEl.textContent = day>=0?day:0;
  phase.textContent = now<STOP_DATE ? 'Vegetation' : 'Final';
}
const dayEl = document.getElementById('day');
const phase = document.getElementById('phase');
updateDay();
setInterval(updateDay,60000);

/* ===== LOOP ===== */
function loop(){
  drawStars();
  drawSensors();

  if(new Date()<STOP_DATE){
    fctx.clearRect(0,0,fieldCanvas.width,fieldCanvas.height);
    wheatField.forEach(w=>{
      w.grow();
      w.draw();
    });
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
